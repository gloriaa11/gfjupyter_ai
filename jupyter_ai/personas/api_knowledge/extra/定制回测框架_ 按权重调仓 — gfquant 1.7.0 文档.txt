
定制回测框架: 按权重调仓
View page source
定制回测框架: 按权重调仓
¶
输入格式和PMS一样，输出结果也相似
[1]:
from
gfquant
import
run_backtest_by_weight
[2]:
# 要运行这个程序，需要上传一个excel或者其他格式的持仓文件，读取到一个DataFrame里。
# DataFrame必须包含“证券代码”、“持仓权重”和“调整日期”三列，其它多余的列不会被使用。示例格式如下所示
import
pandas
as
pd
df
=
pd
.
read_pickle
(
'广发红利价值指数持仓.pkl'
)
df
.
head
()
[2]:
证券代码
持仓权重
成本价格
调整日期
证券类型
名称
0
600030.SH
0.0465
31.77
20091231
股票
中信证券
1
601166.SH
0.0453
40.31
20091231
股票
兴业银行
2
600000.SH
0.0406
21.69
20091231
股票
浦发银行
3
601601.SH
0.0345
25.62
20091231
股票
中国太保
4
601398.SH
0.0343
5.44
20091231
股票
工商银行
[3]:
config
=
{
# 'start_date': '20091231',  # 如不指定start_date，则取df参数中的首次调仓日期
'end_date'
:
'20190329'
,
'benchmark'
:
'000906.SH'
,
'holding'
:
df
,
# 指定调仓记录DataFrame，格式见上
'reb_at_pre_day'
:
False
,
# True则为提前一个交易日调仓，某些情况下（调仓DataFrame格式为日初持仓时）用得上
}
report
=
run_backtest_by_weight
(
config
)
{{progress_text}}
累积净值
超额收益
相对净值
周度收益
月度收益
平均收益
年化换手
Nav
Excess
Relative Nav
Weekly Return
Monthly Return
Average Excess Return
Annualized Turnover
{{log}}
[4]:
# 回测结束后可以取report里保存的信息，如report.portfolio, report.holdings
report
[4]:
BackTest.Report(keys=['annual_perf', 'cash', 'holdings', 'portfolio', 'rtn_average', 'rtn_month', 'rtn_week', 'trades', 'turnover_annualized', 'user_context'])
report中除了回测的历史净值、持仓、交易、配置参数等信息外，还可以调用一些快捷函数
[5]:
exp_sector
,
exp_factor
=
report
.
exposure
(
'20190329'
,
'ZZ800'
)
exp_factor
[5]:
因子暴露(基准ZZ800)
20190329(超额暴露)
BARRA_SIZE
0.489693
0.293522
BARRA_BETA
0.069375
-0.346234
BARRA_MOMENTUM
0.300548
0.034024
BARRA_RESVOL
-0.039498
-0.276214
BARRA_NLSIZE
-0.119806
-0.244657
BARRA_BTOP
-0.030629
0.378234
BARRA_LIQUIDITY
0.384093
-0.153735
BARRA_GROWTH
0.136713
-0.131358
BARRA_EARNYIELD
0.115572
0.575138
BARRA_LEVERAGE
0.293309
0.121387
[6]:
exp_sector
[6]:
行业暴露(基准ZZ800)
20190329(超额暴露)
2019-03-29 00:00:00
交通运输
0.033608
-0.004444
传媒
0.026873
-0.009960
农林牧渔
0.013895
-0.004059
医药
0.072066
-0.005221
商贸零售
0.014809
-0.006532
国防军工
0.018793
-0.003317
基础化工
0.025184
-0.003229
家电
0.040956
0.011353
建材
0.013727
-0.000909
建筑
0.031133
0.003240
房地产
0.052500
-0.001001
有色金属
0.028038
-0.001246
机械
0.028899
-0.008401
汽车
0.029333
-0.002666
消费者服务
0.007100
0.000041
煤炭
0.009782
0.000112
电力及公用事业
0.031790
-0.003986
电力设备及新能源
0.024361
-0.007510
电子
0.048066
-0.005282
石油石化
0.017000
0.000349
纺织服装
0.002714
-0.001292
综合
0.005624
-0.002540
计算机
0.033508
-0.013958
轻工制造
0.007191
-0.004416
通信
0.023218
-0.001961
钢铁
0.016169
-0.005212
银行
0.127329
0.040003
非银行金融
0.140712
0.035455
食品饮料
0.075618
0.006595
[7]:
report
.
brinson
(
'ZZ800'
)[
0
]
[7]:
I
II
III
IV
Alloc
Select
Inter
Total
石油石化
-0.005172
-0.005473
-0.012874
-0.013339
-0.000300
-0.007701
-0.000165
-0.008167
交通运输
-0.002756
-0.007554
0.000731
-0.004556
-0.004798
0.003486
-0.000489
-0.001801
轻工制造
-0.000913
-0.000980
-0.004164
-0.002615
-0.000068
-0.003252
0.001617
-0.001703
纺织服装
-0.000763
-0.002115
0.007883
0.001361
-0.001352
0.008646
-0.005171
0.002124
建材
0.006691
0.003603
0.025992
0.012309
-0.003088
0.019301
-0.010594
0.005618
消费者服务
0.005074
0.003508
0.016572
0.012873
-0.001566
0.011498
-0.002133
0.007799
综合
0.003771
0.007177
0.013740
0.014412
0.003407
0.009969
-0.002734
0.010641
农林牧渔
0.004754
0.002922
0.028759
0.015440
-0.001832
0.024005
-0.011488
0.010686
医药
0.051774
0.042984
0.080256
0.064262
-0.008790
0.028482
-0.007205
0.012488
钢铁
-0.019557
-0.021303
-0.003251
-0.005352
-0.001746
0.016306
-0.000355
0.014205
电力设备及新能源
-0.005384
-0.005605
0.021195
0.010919
-0.000221
0.026579
-0.010056
0.016303
食品饮料
0.073665
0.084983
0.080576
0.091480
0.011318
0.006911
-0.000414
0.017815
商贸零售
-0.002351
-0.002518
0.020351
0.016800
-0.000167
0.022702
-0.003385
0.019151
电力及公用事业
-0.000457
0.001922
0.025064
0.024914
0.002379
0.025521
-0.002529
0.025371
计算机
0.007260
0.003650
0.059862
0.034558
-0.003610
0.052602
-0.021695
0.027298
传媒
-0.016943
-0.023237
0.029584
0.016476
-0.006294
0.046527
-0.006814
0.033419
有色金属
-0.019305
-0.025557
0.032125
0.016076
-0.006252
0.051429
-0.009797
0.035380
煤炭
-0.026156
-0.033720
0.013779
0.010931
-0.007564
0.039935
0.004716
0.037086
国防军工
0.004028
0.003638
0.047365
0.042441
-0.000390
0.043337
-0.004534
0.038413
汽车
0.013374
0.014812
0.053961
0.053954
0.001439
0.040588
-0.001446
0.040580
通信
0.007551
0.006243
0.067773
0.057892
-0.001308
0.060221
-0.008573
0.050341
房地产
0.034464
0.026098
0.108968
0.089253
-0.008367
0.074503
-0.011348
0.054788
家电
0.042243
0.049433
0.090371
0.105322
0.007191
0.048129
0.007759
0.063079
机械
-0.006060
-0.010012
0.093169
0.063945
-0.003952
0.099229
-0.025271
0.070005
电子
0.027153
0.020500
0.122049
0.102359
-0.006653
0.094896
-0.013037
0.075206
建筑
0.013947
0.012815
0.090208
0.095385
-0.001132
0.076261
0.006309
0.081438
基础化工
-0.002208
0.001406
0.139691
0.092594
0.003614
0.141899
-0.050711
0.094803
银行
0.071823
0.099778
0.167554
0.229740
0.027955
0.095731
0.034232
0.157917
非银行金融
0.057733
0.068550
0.217764
0.276814
0.010818
0.160032
0.048232
0.219082
Sum
0.317280
0.315951
1.635052
1.526645
-0.001328
1.317772
-0.107078
1.209366
[8]:
report
.
_get_holdings2
(
'20190329'
)
[8]:
date
code
shares
price
weight
name
level_1_citic
125089
2019-03-29
000100.SZ
8.204676e+05
4.06
0.013206
TCL集团
家电
125090
2019-03-29
000157.SZ
1.152970e+06
4.48
0.020478
中联重科
机械
125091
2019-03-29
000415.SZ
2.346615e+05
4.65
0.004326
渤海租赁
非银行金融
125092
2019-03-29
000630.SZ
2.165222e+06
2.56
0.021975
铜陵有色
有色金属
125093
2019-03-29
000651.SZ
2.086532e+05
47.21
0.039052
格力电器
家电
125094
2019-03-29
000768.SZ
2.287395e+05
17.05
0.015462
中航飞机
国防军工
125095
2019-03-29
000776.SZ
3.550233e+05
16.17
0.022759
广发证券
非银行金融
125096
2019-03-29
000876.SZ
1.863714e+05
13.30
0.009827
新希望
农林牧渔
125097
2019-03-29
000895.SZ
2.204684e+05
25.85
0.022594
双汇发展
食品饮料
125098
2019-03-29
000898.SZ
4.843876e+05
5.70
0.010946
鞍钢股份
钢铁
125099
2019-03-29
002001.SZ
2.900835e+05
18.48
0.021253
新和成
医药
125100
2019-03-29
002146.SZ
6.054512e+04
11.25
0.002700
荣盛发展
房地产
125101
2019-03-29
002304.SZ
2.646748e+04
130.42
0.013685
洋河股份
食品饮料
125102
2019-03-29
002415.SZ
2.171764e+05
35.07
0.030195
海康威视
电子
125103
2019-03-29
002572.SZ
2.725917e+04
25.65
0.002772
索菲亚
轻工制造
125104
2019-03-29
300251.SZ
4.932846e+05
8.64
0.016897
光线传媒
传媒
125105
2019-03-29
300433.SZ
3.684645e+05
8.59
0.012548
蓝思科技
电子
125106
2019-03-29
600028.SH
7.616411e+05
5.74
0.017332
中国石化
石油石化
125107
2019-03-29
600030.SH
1.496137e+05
24.78
0.014698
中信证券
非银行金融
125108
2019-03-29
600068.SH
7.373688e+05
7.26
0.021223
葛洲坝
建筑
125109
2019-03-29
600104.SH
2.441518e+05
26.07
0.025234
上汽集团
汽车
125110
2019-03-29
600153.SH
2.094949e+05
8.66
0.007193
建发股份
交通运输
125111
2019-03-29
600188.SH
2.349874e+05
10.61
0.009884
兖州煤业
煤炭
125112
2019-03-29
600271.SH
1.763857e+05
27.93
0.019531
航天信息
计算机
125113
2019-03-29
600352.SH
3.216692e+05
17.20
0.021934
浙江龙盛
基础化工
125114
2019-03-29
600362.SH
7.746595e+04
15.60
0.004791
江西铜业
有色金属
125115
2019-03-29
600383.SH
4.728916e+05
13.75
0.025778
金地集团
房地产
125116
2019-03-29
600398.SH
3.668819e+04
9.77
0.001421
海澜之家
纺织服装
125117
2019-03-29
600516.SH
1.429916e+05
22.59
0.012806
方大炭素
建材
125118
2019-03-29
600519.SH
7.530617e+03
853.99
0.025496
贵州茅台
食品饮料
125119
2019-03-29
600522.SH
5.383531e+05
9.95
0.021236
中天科技
通信
125120
2019-03-29
600566.SH
8.938209e+03
34.52
0.001223
济川药业
医药
125121
2019-03-29
600606.SH
7.684489e+05
7.54
0.022971
绿地控股
房地产
125122
2019-03-29
600704.SH
1.372885e+05
5.66
0.003081
物产中大
综合
125123
2019-03-29
600741.SH
1.741584e+04
20.38
0.001407
华域汽车
汽车
125124
2019-03-29
600887.SH
1.764127e+05
29.11
0.020359
伊利股份
食品饮料
125125
2019-03-29
600900.SH
4.153268e+05
16.87
0.027778
长江电力
电力及公用事业
125126
2019-03-29
601006.SH
6.636741e+05
8.34
0.021944
大秦铁路
交通运输
125127
2019-03-29
601009.SH
7.739203e+05
7.91
0.024270
南京银行
银行
125128
2019-03-29
601166.SH
4.626834e+05
18.17
0.033329
兴业银行
银行
125129
2019-03-29
601211.SH
3.420533e+05
20.15
0.027325
国泰君安
非银行金融
125130
2019-03-29
601288.SH
2.073172e+06
3.73
0.030657
农业银行
银行
125131
2019-03-29
601318.SH
2.580907e+05
77.10
0.078889
中国平安
非银行金融
125132
2019-03-29
601398.SH
4.357493e+05
5.57
0.009622
工商银行
银行
125133
2019-03-29
601601.SH
2.074935e+05
34.04
0.028002
中国太保
非银行金融
125134
2019-03-29
601607.SH
2.864348e+05
20.68
0.023484
上海医药
医药
125135
2019-03-29
601668.SH
5.405990e+05
6.12
0.013116
中国建筑
建筑
125136
2019-03-29
601818.SH
1.475131e+06
4.10
0.023978
光大银行
银行
125137
2019-03-29
601828.SH
1.594600e+05
13.08
0.008269
美凯龙
商贸零售
125138
2019-03-29
601877.SH
1.584492e+05
26.80
0.016835
正泰电器
电力设备及新能源
125139
2019-03-29
601888.SH
2.567790e+04
70.08
0.007134
中国国旅
消费者服务
125140
2019-03-29
601988.SH
1.700236e+06
3.77
0.025412
中国银行
银行
125141
2019-03-29
601998.SH
7.981595e+05
6.29
0.019904
中信银行
银行
125142
2019-03-29
603858.SH
1.812908e+05
28.97
0.020822
步长制药
医药
[9]:
report
.
_get_trades2
(
'20190228'
)
[9]:
date
code
trade_quantity
price
trade_type
name
level_1_citic
7258
2019-02-28
000100.SZ
8.204676e+05
3.23
建仓
TCL集团
家电
7259
2019-02-28
000157.SZ
1.245431e+03
4.20
增仓
中联重科
机械
7260
2019-02-28
000333.SZ
-6.090621e+04
47.78
清仓
美的集团
家电
7261
2019-02-28
000415.SZ
-1.058018e+06
4.62
减仓
渤海租赁
非银行金融
7262
2019-02-28
000630.SZ
2.165222e+06
2.37
建仓
铜陵有色
有色金属
7263
2019-02-28
000651.SZ
2.180347e+03
44.80
增仓
格力电器
家电
7264
2019-02-28
000768.SZ
2.287395e+05
16.22
建仓
中航飞机
国防军工
7265
2019-02-28
000776.SZ
-4.276823e+04
16.49
减仓
广发证券
非银行金融
7266
2019-02-28
000876.SZ
-1.905859e+04
10.60
减仓
新希望
农林牧渔
7267
2019-02-28
000895.SZ
2.957862e+04
24.15
增仓
双汇发展
食品饮料
7268
2019-02-28
000898.SZ
3.084289e+03
5.67
增仓
鞍钢股份
钢铁
7269
2019-02-28
002001.SZ
-9.898260e+03
17.69
减仓
新和成
医药
7270
2019-02-28
002146.SZ
-5.728809e+04
9.55
减仓
荣盛发展
房地产
7271
2019-02-28
002179.SZ
-8.985745e+04
40.99
清仓
中航光电
国防军工
7272
2019-02-28
002304.SZ
1.367416e+04
111.05
增仓
洋河股份
食品饮料
7273
2019-02-28
002415.SZ
9.004362e+04
34.50
增仓
海康威视
电子
7274
2019-02-28
002572.SZ
-2.257701e+03
18.56
减仓
索菲亚
轻工制造
7275
2019-02-28
300251.SZ
7.064079e+04
8.84
增仓
光线传媒
传媒
7276
2019-02-28
300433.SZ
-3.773409e+05
8.50
减仓
蓝思科技
电子
7277
2019-02-28
600028.SH
2.819922e+03
6.01
增仓
中国石化
石油石化
7278
2019-02-28
600030.SH
8.572826e+04
23.51
增仓
中信证券
非银行金融
7279
2019-02-28
600068.SH
-8.589912e+03
7.09
减仓
葛洲坝
建筑
7280
2019-02-28
600104.SH
1.052308e+04
28.32
增仓
上汽集团
汽车
7281
2019-02-28
600153.SH
1.065134e+04
8.51
增仓
建发股份
交通运输
7282
2019-02-28
600170.SH
-1.020480e+06
3.55
清仓
上海建工
建筑
7283
2019-02-28
600188.SH
-2.413903e+04
10.56
减仓
兖州煤业
煤炭
7284
2019-02-28
600271.SH
1.685318e+04
28.41
增仓
航天信息
计算机
7285
2019-02-28
600309.SH
-8.821275e+04
40.87
清仓
万华化学
基础化工
7286
2019-02-28
600352.SH
3.216692e+05
10.86
建仓
浙江龙盛
基础化工
7287
2019-02-28
600362.SH
7.746595e+04
15.55
建仓
江西铜业
有色金属
...
...
...
...
...
...
...
...
7289
2019-02-28
600398.SH
-1.700911e+03
9.85
减仓
海澜之家
纺织服装
7290
2019-02-28
600487.SH
-2.464281e+05
21.56
清仓
亨通光电
通信
7291
2019-02-28
600516.SH
-1.115746e+04
22.24
减仓
方大炭素
建材
7292
2019-02-28
600518.SH
-7.881105e+05
10.62
清仓
康美药业
医药
7293
2019-02-28
600519.SH
-1.942517e+03
755.01
减仓
贵州茅台
食品饮料
7294
2019-02-28
600522.SH
5.383531e+05
9.89
建仓
中天科技
通信
7295
2019-02-28
600566.SH
8.938209e+03
35.04
建仓
济川药业
医药
7296
2019-02-28
600606.SH
3.056667e+04
6.96
增仓
绿地控股
房地产
7297
2019-02-28
600704.SH
9.846537e+03
5.44
增仓
物产中大
综合
7298
2019-02-28
600741.SH
-4.623227e+03
20.75
减仓
华域汽车
汽车
7299
2019-02-28
600887.SH
-4.284419e+03
27.04
减仓
伊利股份
食品饮料
7300
2019-02-28
600900.SH
2.159320e+04
16.30
增仓
长江电力
电力及公用事业
7301
2019-02-28
601006.SH
4.101866e+04
8.93
增仓
大秦铁路
交通运输
7302
2019-02-28
601009.SH
4.159868e+04
7.44
增仓
南京银行
银行
7303
2019-02-28
601166.SH
-5.075326e+04
17.86
减仓
兴业银行
银行
7304
2019-02-28
601211.SH
-7.019706e+03
19.51
减仓
国泰君安
非银行金融
7305
2019-02-28
601288.SH
1.175212e+05
3.80
增仓
农业银行
银行
7306
2019-02-28
601318.SH
-3.928001e+04
70.01
减仓
中国平安
非银行金融
7307
2019-02-28
601398.SH
-9.637377e+04
5.75
减仓
工商银行
银行
7308
2019-02-28
601601.SH
2.074935e+05
34.02
建仓
中国太保
非银行金融
7309
2019-02-28
601607.SH
2.482305e+05
18.42
增仓
上海医药
医药
7310
2019-02-28
601668.SH
5.405990e+05
6.15
建仓
中国建筑
建筑
7311
2019-02-28
601818.SH
1.008906e+05
4.23
增仓
光大银行
银行
7312
2019-02-28
601828.SH
1.452524e+02
12.54
增仓
美凯龙
商贸零售
7313
2019-02-28
601877.SH
1.406200e+04
25.24
增仓
正泰电器
电力设备及新能源
7314
2019-02-28
601888.SH
-3.967526e+02
63.80
减仓
中国国旅
消费者服务
7315
2019-02-28
601899.SH
-1.679716e+06
3.58
清仓
紫金矿业
有色金属
7316
2019-02-28
601988.SH
9.796094e+04
3.84
增仓
中国银行
银行
7317
2019-02-28
601998.SH
-6.484764e+03
6.55
减仓
中信银行
银行
7318
2019-02-28
603858.SH
3.746422e+04
28.04
增仓
步长制药
医药
61 rows × 7 columns
Next
Previous
© Copyright 2018-2022, GF Funds 量化投资部
Built with
Sphinx
using a
theme
provided by
Read the Docs
.